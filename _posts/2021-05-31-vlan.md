---
layout: article
title: Vlan
---

雰囲気をメモする

## Vlan ってなんの略

- Virtual LAN (Local Area Network) の略



## ポートベース Vlan

- ポート単位でセグメントを分ける
- Vlan 間通信にはルータが必要、もしくはスイッチそのものが L3 スイッチでないといけない

## タグ Vlan

- IEEE802.1Q で標準化されている
- セグメントごとに Vlan ID を設定する

- Vlan にポートを所属させる / ポートに Vlan を設定する

- ポートが Vlan のアンタグ、タグポートに所属しているかに基づいてフレームを処理する(送信時/受信時)

    - フレームを送信するとき
        - 送信ポートがタグポートに所属しているならフレームのイーサネットヘッダに Vlan タグを挿入する
        - 送信ポートがアンタグポートに所属しているならフレームのイーサネットヘッダに Vlan タグを挿入しない

    - 受信したフレームがタグ付き(Vlan ID 10 とする)の場合
        - 受信ポートが Vlan 10 のタグポートに所属しているなら、フレームは Vlan 10 のものとして処理される
        - 受信ポートが Vlan 10 のタグポートに所属していないなら、フレームは無効なものとして破棄される

    - 受信したフレームがタグなしの場合
        - 受信ポートが Vlan 20 のアンタグポートに所属しているなら、フレームは Vlan 20 のものとして処理される
        - 受信ポートがどの Vlan のアンタグポートにも所属していないなら、フレームは無効なものとして破棄される


### アンタグ (Untagged) ポートとタグ (Tagged) ポート

- ポートは、0または1つの Vlan にアンタグポートとして所属できる
- ポートは、0または複数の Vlan にタグポートとして所属できる
- ポートは、1つ以上の Vlan に所属しなければならない
- ポートは、同一の Vlan にタグポートかつアンタグポートとして所属できない (どちらか一方のみ)

### PVID

- ポート Vlan ID の略
- タグなしのフレームが PVID として設定された Vlan として処理される


## アクセスポートとトランクポート

- Cisco 用語っぽい
- アクセスポートはポートベース Vlan
    - タグなしフレームを扱うポート
    - 1つの Vlan に所属できる
- トランクポートはタグ Vlan
    - タグなしフレームとタグ付きフレームの両方を扱うポート
        - タグなしフレームを扱う Vlan はネイティブ Vlan として設定する
    - 複数の Vlan に所属できる
- ポートをアクセスポートかつトランクポートに設定することはできない (どちらか一方のみ)

### デフォルト Vlan

- スイッチの初期状態から存在する Vlan のこと
- 削除は不可
    - 最低1つのポートがデフォルト Vlan に所属しないといけない、というわけではない (おそらく)

### ネイティブ Vlan

- トランクポートに所属するポートが、受信した Vlan タグなしのフレームを所属させる Vlan のこと
- ポートをトランクポートに設定すると、デフォルト Vlan がネイティブ Vlan になる
    - コマンドでネイティブ Vlan を変更できる
    - タグなしのフレームを扱わないようにしたい場合、ネイティブ Vlan をなしに設定できる
- 1つ以上の Vlan のタグポートに所属するポートにアンタグポートを設定するのは、トランクポートにネイティブ Vlan を設定するのと同じ (たぶん)


## 参考

- マスタリング TCP/IP 入門編 第5版
- https://www.allied-telesis.co.jp/support/list/router/ar450s/docs/vlan.pdf
- https://www.alaxala.com/jp/techinfo/archive/manual/AX5400S/HTML/10_10_/APGUIDE/0081.HTM
- http://www.rtpro.yamaha.co.jp/SW/docs/swx2300/Rev_2_00_15/L2_switching/VLAN.html?rev=2.00.15&category=L2SW
- https://www.buffalo.jp/s3/guide/bs-gs/type01/99/ja/pc_index.html?Chapter2#h3anc2


